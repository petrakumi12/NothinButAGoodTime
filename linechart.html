<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Line Chart</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>
<script>
    console.log(d3);

    let margin = {top: 20, right: 20, bottom: 20, left: 20},
        width = 900 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

    let svg = d3.select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .style("mix-blend-mode", "hard-light")
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    let data = [];
    let datadict = {};
    let min = 100, max = -100;
    let generateTS = () => {
        let tempData = Array(50001);
        tempData[0] = 0;
        for (let i = 1; i <= 50000; i++) {
            let diff = Math.random() - 0.5;
            tempData[i] = tempData[i - 1] + diff;

            if (tempData[i] > max) {
                max = tempData[i]
            } else if (tempData[i] < min) {
                min = tempData[i]
            }
        }
        return tempData;
    };

    data = generateTS();

    // TODO comment for 1 TS, uncomment for array of TS
    data = []
    for (let j = 0; j < 101; j++) {
        // console.log("before", data)
        data.push(generateTS())
        // console.log("after", data)
    }

    var x = d3.scaleLinear()
        .domain([0, data[0].length])
        .range([0, width]);

    let y = d3.scaleLinear()
        .domain([min, max])
        .range([height - margin.top - margin.bottom, 0]);

    let newData = []
    data.forEach(d => {
        let max = d3.max(d);
        let min = d3.min(d)
       // svg.append("g")
       //     .selectAll("line")
       //     .data([mean])
       //     .enter()
       //     .append("line")
       //     .attr("y1", d => y(d))
       //     .attr("y2", d => y(d))
       //     .attr("x1", 0)
       //     .attr("x2", 10000)
       //     .attr("stroke-width", 1)
       //     .attr("stroke", "steelblue")
       //  console.log("mean", mean)
       //  console.log("stddev", stddev)

        d = d.map(pt => { return (pt - min) / (max - min) })
        newData.push(d)
    })

    let line = d3.line()
        .x((d, i) => {return x(i)})
        .y((d) => {return y(d)});

    svg.append("g")
        .attr("id", "xAxis")
        .attr("transform", "translate(0," + (height - margin.top - margin.bottom) + ")")
        .call(d3.axisBottom(x));

    svg.append("g")
        .attr("id", "yAxis")
        .call(d3.axisLeft(y));

    // console.log(svg)
    svg.append("g").selectAll("path")
        // .data(data.concat(newData))
        .data(data)
        .enter()
        .append("path")
        .attr("d", d => { return line(d) })
        // .style("background-color", d => {console.log("meee", d);})
        .style("stroke", "steelblue")
        .style("stroke-width", 2)
        .style("fill", "none")
        .style("opacity", 0.1)

</script>
</body>
</html>